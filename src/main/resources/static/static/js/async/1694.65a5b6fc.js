/*! For license information please see 1694.65a5b6fc.js.LICENSE.txt */
(self.webpackChunkkiut_client=self.webpackChunkkiut_client||[]).push([["1694"],{45373:function(e,l,t){"use strict";t.r(l);var n=t("58865");t("33948");var i=t("85893"),r=t("67294"),o=t("50533"),a=t("71893"),s=t("30381"),d=t.n(s),u=t("52861"),c=t("16393"),h=t("2802");function f(){let e=(0,n._)(["\n  padding: 10px 0;\n"]);return f=function(){return e},e}function p(){let e=(0,n._)(["\n    width: 100%;\n    padding: 1rem;\n"]);return p=function(){return e},e}let x=a.default.div(f()),v=a.default.div(p());l.default=()=>{var e;let l=(0,o.useSelector)(e=>{var l;return null==e?void 0:null===(l=e.student)||void 0===l?void 0:l.student}),[t,n]=(0,r.useState)(d()(c.serverTimeStorage));return t&&(0,i.jsxs)(v,{children:[(0,i.jsx)(x,{children:(0,i.jsx)(u.default,{size:"small",label:"Date of the week",type:"week",sx:{width:"200px"},value:t.format("YYYY-[W]WW"),onChange:e=>{n(d()(e.target.value))}})}),(0,i.jsx)(h.default,{userId:null==l?void 0:l.id,group:null==l?void 0:null===(e=l.groupData)||void 0===e?void 0:e.name,dateInput:t})]})}},2802:function(e,l,t){"use strict";t.r(l),t.d(l,{default:function(){return f}});var n=t("58865");t("52550"),t("33948"),t("33792"),t("57640"),t("9924"),t("31672"),t("59461"),t("2490"),t("88449"),t("19894");var i=t("85893"),r=t("67294"),o=t("93065"),a=t("16393"),s=t("7104"),d=t("30381"),u=t.n(d),c=t("50533");function h(){let e=(0,n._)(["\n    width: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-direction: column;\n    gap: 5px;\n"]);return h=function(){return e},e}function f(e){var l;let{group:t,dateInput:n,userId:d}=e,[h,f]=(0,r.useState)([]),[x,v]=(0,r.useState)([]),[m,b]=(0,r.useState)(!1),[g,j]=(0,r.useState)(!1),y=(0,c.useSelector)(e=>e.hourSection),T=async()=>{j(!0),b(!1);try{var e,l,i;let r=await o.default.get("/timeTableByWeekOfYear/studentTimeTable/".concat(t,"/").concat(d,"?year=").concat(n.year(),"&week=").concat(n.isoWeek(),"&day=0&s=false"));f(Object.values((null==r?void 0:null===(e=r.data)||void 0===e?void 0:e.obj)||{}).flat()),v((null==r?void 0:null===(i=r.data)||void 0===i?void 0:null===(l=i.secondObj)||void 0===l?void 0:l.flat())||[])}catch(e){b(!0)}finally{j(!1)}};(0,r.useEffect)(()=>{n.isValid()&&T()},[n]);let C=null===(l=(e=>{let l=e.startOf("isoWeek");return Array.from({length:6},(e,t)=>l.clone().add(t,"days").toDate())})(n))||void 0===l?void 0:l.map((e,l)=>{let t=u()(e).format("dd"),n=u()(e).format("dddd"),i=t.charAt(0).toUpperCase()+t.slice(1).toLowerCase();return{day:l+1,name:i,name2:n.charAt(0).toUpperCase()+n.slice(1).toLowerCase(),date:u()(e)}}),w=(e,l,t,n)=>{let r=u()(n).set({hour:u()(t).hours(),minute:u()(t).minutes()});if(u()(a.serverTimeStorage).isAfter(r)){var o;if(!e||!l)return(0,i.jsx)(s.Chip,{label:(0,i.jsx)("p",{style:{fontSize:11},children:"Missed"}),color:"error",size:"small"});let t=u()(e),n=u()(null===(o=y.find(e=>e.number===l))||void 0===o?void 0:o.start).date(t.date()).diff(t,"milliseconds"),r=u().utc(Math.abs(n)).format("mm:ss");return n<0?(0,i.jsx)(s.Tooltip,{title:t.format("HH:mm"),arrow:!0,placement:"top",children:(0,i.jsx)(s.Chip,{label:(0,i.jsx)("p",{style:{fontSize:11},children:r}),color:"warning",size:"small"})}):n>0?(0,i.jsx)(s.Tooltip,{title:t.format("HH:mm"),arrow:!0,placement:"top",children:(0,i.jsx)(s.Chip,{label:(0,i.jsx)("p",{style:{fontSize:11},children:r}),color:"success",size:"small"})}):(0,i.jsx)(s.Chip,{label:"On time",color:"default",size:"small"})}},k=(e,l,t)=>{var n;if(!e)return"Missed";let{dayNumber:r,hourNumber:o}=e,a=(null==x?void 0:x.filter(e=>(null==e?void 0:e.weekday)===r&&(null==e?void 0:e.section)===o).sort((e,l)=>e.time-l.time)[0])||null,d=(null==x?void 0:null===(n=x.filter(e=>(null==e?void 0:e.weekday)===r&&(null==e?void 0:e.section)===o))||void 0===n?void 0:n.find(e=>"DYNAMIC"===e.type))||null;return d?d.isCome?(0,i.jsx)(s.Chip,{label:(0,i.jsx)("p",{style:{fontSize:11},children:"Coming"}),color:"#FFA500",size:"small"}):(0,i.jsx)(s.Chip,{label:(0,i.jsx)("p",{style:{fontSize:11},children:"Missed"}),color:"error",size:"small"}):w(null==a?void 0:a.time,null==a?void 0:a.section,l.start,t)};return(0,i.jsxs)(s.Box,{py:2,children:[g&&(0,i.jsx)(s.Stack,{spacing:1,children:(0,i.jsx)(s.Skeleton,{variant:"rectangular",width:"100%",height:490})}),m&&(0,i.jsx)(s.Typography,{color:"error",align:"center",children:"Failed to fetch data. Please try again later."}),!g&&!m&&0===h.length&&(0,i.jsx)(s.Typography,{align:"center",children:"No data available for the selected week."}),!g&&!m&&(null==h?void 0:h.length)>0&&(0,i.jsx)(s.TableContainer,{component:s.Paper,sx:{overflow:"auto"},children:(0,i.jsxs)(s.Table,{sx:{minWidth:2200},children:[(0,i.jsx)(s.TableHead,{children:(0,i.jsxs)(s.TableRow,{children:[(0,i.jsx)(s.TableCell,{sx:{position:"sticky",left:0,backgroundColor:"#fff",zIndex:1,borderRight:"1px solid rgba(224, 224, 224, 1)"},align:"center",children:(0,i.jsx)("strong",{children:"TIME"})}),null==y?void 0:y.map((e,l)=>(0,i.jsx)(s.TableCell,{sx:{width:200,borderRight:"1px solid rgba(224, 224, 224, 1)"},align:"center",children:(0,i.jsx)("strong",{children:null==e?void 0:e.hour})},l))]})}),(0,i.jsx)(s.TableBody,{children:C.map((e,l)=>{let t=h.filter(l=>l.dayNumber===e.day);return(0,i.jsxs)(s.TableRow,{children:[(0,i.jsx)(s.TableCell,{sx:{position:"sticky",left:0,backgroundColor:"#fff",zIndex:1,height:170,borderRight:"1px solid rgba(224, 224, 224, 1)"},align:"center",children:(0,i.jsx)(s.Typography,{fontSize:12,children:(0,i.jsxs)("b",{children:[null==e?void 0:e.name2,(0,i.jsx)("br",{})," ",null==e?void 0:e.date.format("DD.MM.YYYY")]})})}),y.map((l,n)=>{var r;let o=t.find(e=>e.hourNumber===l.number),a=k(o,l,null==e?void 0:e.date);return o?(0,i.jsxs)(s.TableCell,{align:"center",sx:{position:"relative",borderRight:"1px solid rgba(224, 224, 224, 1)"},children:[(0,i.jsx)(s.Typography,{sx:{position:"absolute",top:5,left:"50%",transform:"translateX(-50%)"},fontSize:14,fontWeight:"bold",children:null==o?void 0:null===(r=o.room)||void 0===r?void 0:r.substring(0,5)}),(0,i.jsxs)(p,{children:[(0,i.jsx)(s.Typography,{fontSize:11,color:"blue",children:o.lessonName}),(0,i.jsx)(s.Typography,{fontSize:11,fontWeight:"bold",children:o.teacherName})]}),(0,i.jsx)(s.Box,{sx:{position:"absolute",bottom:5,right:5},children:a})]},n):(0,i.jsx)(s.TableCell,{align:"center",sx:{borderRight:"1px solid rgba(224, 224, 224, 1)"}},n)})]},l)})})]})})]})}let p=t("71893").default.span(h())}}]);